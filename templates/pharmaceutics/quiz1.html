{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ pageTitle }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.ico' %}"/>
    <link rel="author" href="https://scholar.google.com/citations?user=gci8pWIAAAAJ&hl=en">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    {% include 'CoreStaticTemplates/staticCss.html' %}
    <style>
    [type="radio"]:not(:checked), [type="radio"]:checked {
        position: relative;
        display: inline-flex;
        opacity: 1;
        pointer-events: auto;
        margin-left: 10px;
    }
    .card.correct {
        outline: solid rgb(0, 255, 0);
    }
    .card.incorrect{
        outline: solid red;
    }
    .results {
    background-color: #ddd;
    margin-left: 20%;
    }

    </style>
</head>

<body>
    <div id="content-wrap">
        <div class="container-fluid teal darken-4" style="height: 4rem;">
            <div class="text-center display-4 text-white" style="scale:75%">Pharmaceutics pKa</div>
        </div>
    <input type="button" value="Begin Quiz 1" id="begin" onclick="begin()" style="display: block; margin: 0 auto;">


    <div id="visualcolumn" style="float:left; width:66%; padding:5px; visibility: hidden;">
    add visuals and SVGs here
    </div>
    
    <div id="questioncolumn" style="float:right; width:33%; padding:5px;">
            {% csrf_token %}
            <div id="questionbox1" class="card" style="visibility: hidden; display: block;">                
                <p style = padding:5px; id = "qb1text"> "Which of these molecules would have the highest logP?"</p>
                <img src="">
                <input name="qb1choices"  type="radio" id="qb1_1"> <label id = "ac1label" for="qb1_1"> Choice 1 </label>       <br/>
                <input name="qb1choices"  type="radio" id="qb1_2"> <label id = "ac2label" for="qb1_2"> Choice 2 </label>        <br/>
                <input name="qb1choices"  type="radio" id="qb1_3"> <label id = "ac3label" for="qb1_3"> Choice 3 </label>        <br/>
                <input name="qb1choices"  type="radio" id="qb1_4"> <label id = "ac4label" for="qb1_4"> Choice 4 </label>        <br/>                
            </div>
            <div id="questionbox2" class="card" style="visibility: hidden; display: block;">              
                <p style = padding:5px; id = "qb2text"> "Which of these molecules would be mostly ionized at pH 2?"</p>
                <img src="">
                <input name="qb2choices"  type="radio" id="qb2_1"> <label id = "ac1label" for="qb2_1"> Choice 1 </label>        <br/>
                <input name="qb2choices"  type="radio" id="qb2_2"> <label id = "ac2label" for="qb2_2"> Choice 2 </label>        <br/>
                <input name="qb2choices"  type="radio" id="qb2_3"> <label id = "ac3label" for="qb2_3"> Choice 3 </label>        <br/>
                <input name="qb2choices"  type="radio" id="qb2_4"> <label id = "ac4label" for="qb2_4"> Choice 4 </label>        <br/>          
            </div>
            <div id="questionbox3" class="card" style="visibility: hidden; display: block;">  
                <p style = padding:5px; id = "qb3text"> "Which of these molecules is more flexible?"</p>
                <img src="">
                <input name="qb3choices"  type="radio" id="qb3_1"> <label id = "ac1label" for="qb3_1"> Choice 1 </label>        <br/>
                <input name="qb3choices"  type="radio" id="qb3_2"> <label id = "ac2label" for="qb3_2"> Choice 2 </label>        <br/>
                <input name="qb3choices"  type="radio" id="qb3_3"> <label id = "ac3label" for="qb3_3"> Choice 3 </label>        <br/>
                <input name="qb3choices"  type="radio" id="qb3_4"> <label id = "ac4label" for="qb3_4"> Choice 4 </label>        <br/>
            </div>
            <div id="questionbox4" class="card" style="visibility: hidden; display: block;"> 
                <p style = padding:5px; id = "qb4text"> "Which of these molecules would be the most acidic?"</p>
                <img src="">
                <input name="qb4choices"  type="radio" id="qb4_1"> <label id = "ac1label" for="qb4_1"> Choice 1 </label>        <br/>
                <input name="qb4choices"  type="radio" id="qb4_2"> <label id = "ac2label" for="qb4_2"> Choice 2 </label>        <br/>
                <input name="qb4choices"  type="radio" id="qb4_3"> <label id = "ac3label" for="qb4_3"> Choice 3 </label>        <br/>
                <input name="qb4choices"  type="radio" id="qb4_4"> <label id = "ac4label" for="qb4_4"> Choice 4 </label>        <br/>
            </div>
            <div id="questionbox5" class="card" style="visibility: hidden; display: block;">
                <p style = padding:5px; id = "qb5text"> "Which of these electronegativity maps looks most plausible?"</p>
                <img src="">
                <input name="qb5choices"  type="radio" id="qb5_1"> <label id = "ac1label" for="qb5_1"> Choice 1 </label>        <br/>
                <input name="qb5choices"  type="radio" id="qb5_2"> <label id = "ac2label" for="qb5_2"> Choice 2 </label>        <br/>
                <input name="qb5choices"  type="radio" id="qb5_3"> <label id = "ac3label" for="qb5_3"> Choice 3 </label>        <br/>
                <input name="qb5choices"  type="radio" id="qb5_4"> <label id = "ac4label" for="qb5_4"> Choice 4 </label>        <br/>
            </div>
            <input name="submit" type="button" id="submitquiz" value="Submit" style="visibility: hidden;" onclick="validateresults()">
    </div>

    <div id="results" class="results" style="visibility: hidden; display: inline-block; width: 60%;">                
        <p style = "padding:5px; text-align: center;" id = "qb1text"> <strong>Results</strong></p>
        <p id="score"></p>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script>
    var sec = 0
    var t
    function begin(){
        document.getElementById("begin").disabled=true;
        document.getElementById("begin").style.visibility = "hidden";
        timer()
        document.getElementById("visualcolumn").style.visibility = "visible"
        document.getElementById("submitquiz").style.visibility = "visible"
        cards = Array.from(document.querySelectorAll(".card"))
        cards.forEach(function(el){
            el.style.visibility = "visible"
        });
        //TEST PURPOSES ONLY.
        document.getElementById("qb1_1").value = "correct"
        document.getElementById("qb2_2").value = "correct"
        document.getElementById("qb3_3").value = "correct"
        document.getElementById("qb4_4").value = "correct"
        document.getElementById("qb5_1").value = "correct"
        //TEST PURPOSES ONLY.
    }
    
    function handleSubmit(){
        var token = '{{csrf_token}}';
        clearTimeout(t)
        console.log(sec)
        $.ajax({
            headers: { "X-CSRFToken": token },
            url: 'quiz1post',
            type: 'post',
            data: {
                q1: "",
                q2: "",
                q3: "",
                q4: "",
                q5: "",
            },
            success: function(response) {
                console.log('responses have been saved')
            }
        })
    }

    function validateresults(){
    var correctanswers = 0
    var solved = new Boolean(false);
    let radioanswers = [document.getElementsByName('qb1choices'),document.getElementsByName('qb2choices'),document.getElementsByName('qb3choices'),document.getElementsByName('qb4choices'),document.getElementsByName('qb5choices')]
    var questionboxes = [document.getElementById("questionbox1"), document.getElementById("questionbox2"),document.getElementById("questionbox3"),document.getElementById("questionbox4"),document.getElementById("questionbox5")]
    val = new Array

        for (var k=0, length = radioanswers.length; k<length; k++){
            for (var i = 0; i < 4; i++) {
                if (radioanswers[k][i].checked) {
                val[val.length] = radioanswers[k][i].value;
                break;}
            }
        }

        for (var i=0, numberofq = questionboxes.length; i < numberofq; i++){
        if (val.length != numberofq ) {
            alert('Not all questions have been answered');
            correctanswers = 0
            break;
        } else if (val[i].match("correct") ) {
            questionboxes[i].classList.add("correct");
            correctanswers++
            solved = true
        } else {
            questionboxes[i].classList.add("incorrect");
            solved = true
        }
        }
    if (solved == true) {
        handleSubmit();
        document.getElementById("submitquiz").style.display = "none";
        document.getElementById("results").style.visibility = "visible";
        document.getElementById("score").innerHTML = "You correctly answered " + `${correctanswers}` +" out of 5 questions."
    }
    }

    function timer(){
        t = setTimeout(tick, 1000)
    }
    function tick(){
        sec++
        timer()
    }
</script>